
import React from 'react';
import { 
  AlertTriangle, FileText, Users, CheckSquare, 
  ShieldAlert, Activity, Search, ClipboardCheck, 
  MessageCircle, Scale, Archive, Compass, Moon, Zap, Eye, Sword, Key, RotateCcw
} from 'lucide-react';
import { Phase } from './types';

export const PHASES_DATA: Phase[] = [
  {
    id: 1,
    title: "第一星軌：知悉與法定通報 (危機處理與協助)",
    color: "bg-sky-50 border-sky-200",
    iconName: "Compass",
    tasks: [
      { 
        id: "1.1", 
        text: "獲知疑似事件 (申請調查或檢舉)", 
        note: " 防治準則§19-1：任何人知悉應立即通報學校權責人員。", 
        unit: "學務處" 
      },
      { 
        id: "1.2", 
        text: "【重要】法定通報 (社政及教育主管機關)", 
        note: "性平法§22-1：\n✦ 通報時效：知悉後 24 小時內。\n✦ 通報對象：\n  1. 社政主管機關 (性侵害/兒少保護/身障)\n  2. 學校主管機關 (校安系統)", 
        unit: "學務處", 
        deadlineRef: "report", 
        important: true 
      },
      { 
        id: "1.3", 
        text: "告知當事人 (含家長) 權益與救濟途途径", 
        note: "提供「權益告知書」，包含：心理輔導、法律諮詢、救濟管道等相關資訊。", 
        unit: "" 
      },
      { 
        id: "1.4", 
        text: "啟動提供必要之協助服務", 
        note: "防治準則§26：\n1. 協助範圍：依需求提供身心輔導、課務調整、不當訊問保護。\n2. 緊急處理：必要時進行緊急隔離 (如調整班級/座位)，事後須送性平會追認。", 
        unit: "" 
      },
    ]
  },
  {
    id: 2,
    title: "第二星軌：受理程序及決定判準",
    color: "bg-teal-50 border-teal-200",
    iconName: "Eye",
    tasks: [
      { 
        id: "2.1", 
        text: "初步審查 (收件與不受理認定)", 
        note: "1. 防治準則§15：確認管轄權：非屬本校管轄者，應於 7 日內移送權責機關。\n2. 性平法§32-2：不受理認定：含非本法事項、匿名、已處理完畢。\n3. 防治準則§19-3：審查程序：必要時得組成 3 人以上小組先行認定。", 
        unit: "學務處/性平會三人小組" 
      },
      { 
        id: "2.2", 
        text: "移送性平會", 
        note: "性平法§33-1：除不受理情形外，應於 3 日內將事證資料移交性平會。", 
        unit: "學務處" 
      },
      { 
        id: "2.3", 
        text: "召開性平會", 
        note: "✦ 審議重點：\n1. 認定是否受理、審查不予受理情形。\n2. 若無人申請，討論是否以檢舉案啟動調查 (待家長回覆聲明書後召開)。\n3. 決定受理，正式啟動調查程序。\n4. 決議成立調查小組：\n   - 【例外】事實清楚且無異議：可決議不組小組，由性平會直接調查。\n   - 【強制】涉教職員工案件：一定要組調查小組且成員「全數外聘」。\n   - 確認成員符合法定資格（女性≥1/2，專家≥1/3）。\n5. 調查工作迴避原則：輔導人員、性平會主管/承辦人應迴避。\n6. 議決危機處置與保護措施。\n\n✦ 法律依據：\n• 性平法§32-2：不受理情形認定。\n• 性平法§33-2：行為人為校長/教職工應全外聘；一般案女性≥1/2，專家≥1/3。\n• 性平法§33-4：跨校案件應有被害人現所屬學校代表參與。\n• 防治準則§26-3：必要處置須經性平會決議通過後執行。", 
        unit: "性平會",
        deadlineRef: "meetingDecide",
        important: true 
      },
      { 
        id: "2.4", 
        text: "書面通知當事人 (是否受理決定)", 
        note: "性平法§32-1：\n1. 通知時效：收件後 20 日內。\n2. 通知形式：書面通知。\n3. 應告知事項：是否受理；若為「不受理」應詳細敘明理由。", 
        unit: "學務處" 
      }
    ]
  },
  {
    id: 3,
    title: "第三星軌：調查程序",
    color: "bg-amber-50 border-amber-200",
    iconName: "Key",
    tasks: [
      { 
        id: "3.1", 
        text: "調查訪談前置作業", 
        note: "1. 與委員約定訪談日期。\n2. 召開會前會，確認訪談人員。\n3. 發送正式公文予外部委員。\n4. 製作各式法規表單。\n5. 租借合宜之調查場地。", 
        unit: "學務處" 
      },
      { 
        id: "3.2", 
        text: "通知當事人/相關人配合調查", 
        note: "性平法§33-5/43-4：\n1. 發送書面通知 (應載明事由、時間、地點)。\n2. 告知得申請「陪同人員」(如法定代理人、律師、心理師) 在場協助。\n3. 提醒當事人有配合調查之義務。", 
        unit: "學務處" 
      },
      { 
        id: "3.3", 
        text: "訪談環境安排", 
        note: "1. 確保隱私(獨立空間、隔音)。\n2. 規劃分流動線與當事人家長等候區 (避免雙方狹路相逢))。\n3. 備妥法規、校安通報紀錄、紙筆、錄音筆、各式表單。", 
        unit: "學務處" 
      },
      { 
        id: "3.4", 
        text: "進行調查訪談", 
        note: "性平法§23-1/施行細則§16：\n1. 秉持客觀、公正、專業，給予當事人充分答辯機會。\n2. 避免重複詢問(減少二度傷害)。\n3. 應衡酌雙方權力差距(對不對等關係之敏感度)。", 
        unit: "調查小組",
        important: true 
      },
      { 
        id: "3.5", 
        text: "訪談紀錄確認 (逐字稿)", 
        note: "防治準則§24-11：訪談紀錄應由當事人/受邀人朗讀或閱覽後，簽名確認無誤。如有錄音，應全程錄音並保存。", 
        unit: "學務處" 
      },
      { 
        id: "3.6", 
        text: "保密與檔案處理", 
        note: "防治準則§25-3：原始文書應封存；外發文書應去識別化並以代號為之。\n✦ 教育部 Q&A 203：禁止事項：不得要求當事人簽署保密切結書。", 
        unit: "學務處" 
      },
      { 
        id: "3.7", 
        text: "撰寫調查報告", 
        note: "1. 性平法§31-1: 應於受理後2個月內完成調查. 必要時得延長1個月，可延長兩次(需書面通知當事人)。\n2. 性平法施行細則§17：應包含事實認定及理由、處理建議。", 
        unit: "調查小組",
        deadlineRef: "investigation", 
        important: true
      },
    ]
  },
  {
    id: 4,
    title: "第四星軌：調查結果與報告",
    color: "bg-amber-50 border-amber-200",
    iconName: "Zap",
    tasks: [
      { 
        id: "4.1", 
        text: "性平會審議調查報告 (事實認定)", 
        note: "性平法§41-1：學校應依據性平會調查報告之事實認定或部分事實認定，不宜另為不同之認定。\n防治準則§30-3：審酌後除有重大程序瑕疵或新事證，不得隨意要求重新調查。\n【注意】調查小組報告僅為草案，須經性平會審議通過後才算定案。", 
        unit: "性平會" 
      },
      { 
        id: "4.2", 
        text: "決議「處置」措施(如諮商/課程)", 
        note: "性平法§26-2：性平會可直接決議命行為人接受心理諮商、8小時性平課程等教育處處置。\n(此部分不需移送權責機關，由性平會決定後執行)", 
        unit: "性平會" 
      },
      { 
        id: "4.3", 
        text: "提出「懲處」建議 (如記過/解聘)", 
        note: "性平法§26-1：針對「懲處」(申誡、記過、解聘等)，性平會僅做「建議」。\n(將建議內容載明於報告書中，準備移送權責機關。)", 
        unit: "性平會" 
      },
      { 
        id: "4.4", 
        text: "移送權責機關", 
        note: "性平法§36-3/§41-1：將調查報告移送權責機關 (如教評會、獎懲會)。", 
        unit: "性平會" 
      },
      { 
        id: "4.5", 
        text: "函報主管機關 (調查報告備查)", 
        note: "防治準則§40-1：調查報告經性平會議決後，應報送所屬教育主管機關。\n(目的：確認調查程序完備。並非等懲處執行完才報，此時僅為調查階段之報告。)", 
        unit: "學校專責單位", 
        important: true
      },
    ]
  },
  {
    id: 5,
    title: "第五星軌：懲處與處置執行",
    color: "bg-purple-50 border-purple-200",
    iconName: "Sword",
    tasks: [
      { 
        id: "5.1", 
        text: "權責單位議處收件與通知 (陳述意見)", 
        note: "(防治準則§30-6：通知被害人/家長：限期陳述意見。\n性平法§26-5：通知行為人：若懲處涉及「身分改變」(解聘/免職/退學)，應給予書面陳述意見機會", 
        unit: "權責機關 (如教評會/獎懲會)", 
        important: true
      },
      { 
        id: "5.2", 
        text: "權責機關議處 (不得重新調查)", 
        note: "性平法§41-1：應依性平會之事實認定，審酌雙方陳述意見後，議決懲處結果。\n(若認為調查有瑕疵，應將理由及事證移回性平會，不得自行重新調查)", 
        unit: "權責單位" 
      },
      { 
        id: "5.3", 
        text: "書面通知處理結果", 
        note: "性平法§36-3/防治準則§32-1：應通知申請人、被害人、檢舉人及行為人。\n內容含：1.事實認定 2.處置措施 3.議處結果 4.調查報告(去識別化版) 5.申復期限(30日)與受理單位。)", 
        unit: "學校名義 (承辦人)" 
      },
      { 
        id: "5.4", 
        text: "執行懲處及處處置 (依權責單位議處結果)", 
        note: "性平法§26-1：1.執行懲處 (如記過)。\n2. 執行處置 (如8小時課程)，不配合者報請主管機關裁罰。\n3. 採取必要措施確保遵守；拒不配合者應報請主管機關裁罰。", 
        unit: "相關單位/人事室" 
      },
    ]
  },
  {
    id: 6,
    title: "第六星軌：申復及救濟程序",
    color: "bg-indigo-50 border-indigo-200",
    iconName: "Scale",
    tasks: [
      { 
        id: "6.1", 
        text: "申復提出 (申復選擇權)", 
        note: "性平法§37-1：收到通知次日起30日內，向學校或主管機關申復，以一次為限。\n【重要】若行為人為校長/教職員工，被害人得選擇向「學校」或「主管機關」提出申復 (避免官官相護)。", 
        unit: "當事人", 
        important: true
      },
      { 
        id: "6.2", 
        text: "申復審議 (組審議小組)", 
        note: "防治準則§32-4：\n1. 審議期限：應於30日內作成決定並通知申復人。\n2. 迴避原則：原性平會委員及原調查小組成員不得擔任審議小組成員。", 
        unit: "學校/主管機關申復審議小組" 
      },
      { 
        id: "6.3", 
        text: "申復有理由，重為決定 or 重新調查", 
        note: "性平法§37-3：\n1. 僅限調查程序有重大瑕疵，或發現足以影響事實認定之新事實、新證據。\n2. 重為決定：直接撤銷原處分，另為處分。\n3. 重新調查 (程序瑕疵/新事實)：學校應成立新調查小組，並於「40日內」完成調查。", 
        unit: "性平會(籌組)/新調查小組", 
        important: true
      },
      { 
        id: "6.4", 
        text: "提起救濟 (不服申復結果)", 
        note: "性平法§39-1：收到申復決定書送達日次日起30日內。\n1. 學生/教師：依身分提起訴願/行政訴訟。\n2. 公立教師：可依教師法提起再申訴。", 
        unit: "當事人" 
      },
    ]
  },
  {
    id: 7,
    title: "第七星軌：追蹤與結案",
    color: "bg-slate-50 border-slate-200",
    iconName: "Archive",
    tasks: [
      { 
        id: "7.1", 
        text: "通報與追蹤輔導 (轉校/轉職追蹤)", 
        note: "性平法§28-2/3：行為人轉校或轉職應主動通報受聘學校，並持續追蹤輔導。", 
        unit: "學校專責單位", 
        important: true
      },
      { 
        id: "7.2", 
        text: "追蹤輔導評估與結案", 
        note: "應於完成所有處置程序及追蹤輔導評估後，方得辦理結案 (教育部 Q&A 67, 68)。", 
        unit: "學校專責單位" 
      },
      { 
        id: "7.3", 
        text: "檔案建立與保存 (原始檔案與報告檔案)", 
        note: "防治準則§34-1：應指定專責單位，相關檔案應保存25年。", 
        unit: "學校專責單位" 
      },
    ]
  }
];

export const getIcon = (name: string, customColor?: string) => {
  const commonClasses = customColor ? `w-5 h-5 ${customColor}` : "w-5 h-5 text-tiffany-deep";
  switch (name) {
    case "Compass": return <Compass className={commonClasses} />;
    case "Eye": return <Eye className={commonClasses} />;
    case "Key": return <Key className={commonClasses} />;
    case "Zap": return <Zap className={commonClasses} />;
    case "Sword": return <Sword className={commonClasses} />;
    case "Archive": return <Archive className={commonClasses} />;
    case "Scale": return <Scale className={commonClasses} />;
    case "RotateCcw": return <RotateCcw className={commonClasses} />;
    case "MessageCircle": return <MessageCircle className={commonClasses} />;
    default: return <Moon className={commonClasses} />;
  }
};

export const REGULATORY_CONTEXT = `
你是一位精通台灣《性別平等教育法》與《校園性別事件防治準則》的專業法律顧問。
你的回答必須符合 113 年最新修正之法條規範：
1. 嚴格定義：分析性侵害、性騷擾、性霸凌之法律構成要件。
2. 時效檢核：通報(24小時)、受理決定(20日)、調查完成(2個月)。
3. 程序正義：調查小組成員組成比例及專業性。
請保持專業、冷靜且客備的法律口吻，並引用具體條文編號。
`;
